function HTMLImageElement(){}function HTMLVideoElement(){}function CanvasRenderingContext2D(){}function Storage(){let e={};this.clear=function(){return e={}},this.getItem=function(n){return e.hasOwnProperty(n)?e[n]:void 0},this.removeItem=function(n){return delete e[n]},this.setItem=function(n,t){return e[n]=String(t)}}Canvas=HTMLCanvasElement=OffscreenCanvas,HTMLCanvasElement.name="HTMLCanvasElement",Canvas.name="Canvas",Image=HTMLImageElement,Video=HTMLVideoElement,CanvasRenderingContext2D=CanvasRenderingContext2D;class Document extends EventTarget{}let window,detectorModel,landmarkModel,expressionModel,offscreenCanvas,offscreenCanvasCtx,document=new Document,busy=!1;function init(e){for(let n in e.data.fakeWindow)self[n]||(self[n]=e.data.fakeWindow[n]);window=Window=self,localStorage=new Storage;for(let n in e.data.fakeDocument){if(document[n])continue;let t=e.data.fakeDocument[n];t&&t.type&&"*function*"===t.type?(document[n]=function(){},document[n].name=t.name):document[n]=t}document.createElement=function(e){switch(e){case"canvas":let n=new Canvas(1,1);return n.localName="canvas",n.nodeName="CANVAS",n.tagName="CANVAS",n.nodeType=1,n.innerHTML="",n.remove=(()=>{}),n}},document.location=self.location,(offscreenCanvas=new OffscreenCanvas(640,480)).width=640,offscreenCanvas.height=480,offscreenCanvasCtx=offscreenCanvas.getContext("2d"),self.importScripts("../lib/face-api.js"),(detectorModel=faceapi.nets.tinyFaceDetector.loadFromUri("../lib/models")).then(()=>{(landmarkModel=faceapi.nets.faceLandmark68TinyNet.loadFromUri("../lib/models")).then(()=>{(expressionModel=faceapi.nets.faceExpressionNet.loadFromUri("../lib/models")).then(()=>{})})})}function detectWithExpressions(e){if(busy)return;offscreenCanvasCtx.drawImage(e.data.img,0,0);const n=new faceapi.TinyFaceDetectorOptions({inputSize:160,scoreThreshold:.5});let t;busy=!0,(t=e.data.getEmotions?faceapi.detectSingleFace(offscreenCanvas,n).withFaceLandmarks(!0).withFaceExpressions():faceapi.detectSingleFace(offscreenCanvas,n).withFaceLandmarks(!0)).then(n=>{postMessage({opcode:1,dets:n,frame:e.data.frame}),busy=!1})}onmessage=function(e){0===e.data.opcode?init(e):1===e.data.opcode&&detectWithExpressions(e)};