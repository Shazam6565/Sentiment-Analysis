function getFrame(e,t){t.copy(e,K_PROJECT_WIDTH+1,1,2,K_FRAMECODE_BIT_DEPTH/2,0,0),t.update();let i=new ArrayBuffer(2),a=new Uint16Array(i),o=0;for(let e=0;e<t.height;e+=1)for(let i=0;i<t.width;i+=1){const r=t.getPixel(i,e);(r.r+r.g+r.b)/3>125&&(a[0]|=1<<o),o+=1}return a[0]}function updateCLM(e){e.copy(cvSprite,0,0,cvSprite.width,cvSprite.height,0,0,void 0,void 0,void 0,void 0,void 0,1/K_FACE_CV_DOWNRES_FACTOR,1/K_FACE_CV_DOWNRES_FACTOR),e.update()}function handlePlayDetections(e,t){if(e){const i=e.landmarks._positions;landmarks=new Array;for(let e=0;e<i.length;e+=1)landmarks.push([i[e]._x*userVideoSprite.scale.x*K_FACE_CV_DOWNRES_FACTOR,i[e]._y*userVideoSprite.scale.y*K_FACE_CV_DOWNRES_FACTOR]);if(e.expressions&&getLandmarks?(handleViewerFaceData(t,viewerFaceData,landmarks,e.expressions),emotions=e.expressions):e.expressions&&!getLandmarks?(handleViewerFaceData(t,viewerFaceData,null,e.expressions),emotions=e.expressions):!e.expressions&&getLandmarks&&handleViewerFaceData(t,viewerFaceData,landmarks,null),K_INSTALLATION_MODE){const i=new viewerFaceDataStruct(t,landmarks,e.expressions||null);socket.emit("data",i)}userVideoStatusText.visible=!1}else landmarks=!1,emotions=!1,userVideoStatusText.visible=!0,K_INSTALLATION_MODE&&socket.emit("data",null)}function handleViewerFaceData(e,t,i=null,a=null){const o=new viewerFaceDataStruct(e,i,a);t.push(o)}function drawFaceModel(e){function t(t){faceModel.moveTo(e[t[0]][0],e[t[0]][1]);for(let i=1;i<t.length;i+=1)faceModel.lineTo(e[t[i]][0],e[t[i]][1])}e&&(faceModel.visible=!0,faceModel.clear(),faceModel.lineStyle(2,8453888,1),t(K_FACE_OUTLINE),t(K_FACE_MOUTH_OUTER),t(K_FACE_MOUTH_INNER_TOP),t(K_FACE_MOUTH_INNER_BOTTOM),t(K_FACE_SEPTUM),t(K_FACE_NOSE),t(K_FACE_LEFT_EYE),t(K_FACE_RIGHT_EYE),t(K_FACE_LEFT_BROW),t(K_FACE_RIGHT_BROW))}function drawBigMouthModel(e){const t=[];for(let i=0;i<e.length;i+=1)t.push([e[i][0],e[i][1]]);for(let e=0;e<t.length;e+=1)t[e][0]*=4,t[e][1]*=4;const i=K_PROJECT_WIDTH/2-t[51][0],a=K_PROJECT_HEIGHT/2-t[51][1];for(let e=0;e<t.length;e+=1)t[e][0]+=i,t[e][1]+=a;mouthModel.visible=!0,mouthModel.clear(),mouthModel.lineStyle(6,16711680,1),mouthModel.moveTo(t[K_FACE_MOUTH_OUTER[0]][0],t[K_FACE_MOUTH_OUTER[0]][1]);for(let e=1;e<K_FACE_MOUTH_OUTER.length;e+=1)mouthModel.lineTo(t[K_FACE_MOUTH_OUTER[e]][0],t[K_FACE_MOUTH_OUTER[e]][1]);mouthModel.moveTo(t[K_FACE_MOUTH_INNER_TOP[0]][0],t[K_FACE_MOUTH_INNER_TOP[0]][1]);for(let e=1;e<K_FACE_MOUTH_INNER_TOP.length;e+=1)mouthModel.lineTo(t[K_FACE_MOUTH_INNER_TOP[e]][0],t[K_FACE_MOUTH_INNER_TOP[e]][1]);mouthModel.moveTo(t[K_FACE_MOUTH_INNER_BOTTOM[0]][0],t[K_FACE_MOUTH_INNER_BOTTOM[0]][1]);for(let e=1;e<K_FACE_MOUTH_INNER_BOTTOM.length;e+=1)mouthModel.lineTo(t[K_FACE_MOUTH_INNER_BOTTOM[e]][0],t[K_FACE_MOUTH_INNER_BOTTOM[e]][1])}function drawEmotionChart(){if(emotions){emotionChart.visible=!0,emotionChart.clear(),emotionChart.beginFill(8453888);const e=-165*emotions.angry,t=-165*emotions.sad,i=-165*emotions.surprised,a=-165*emotions.happy;emotionChart.drawRect(10,K_PROJECT_HEIGHT,147.5,e),emotionChart.drawRect(167.5,K_PROJECT_HEIGHT,147.5,t),emotionChart.drawRect(325,K_PROJECT_HEIGHT,147.5,i),emotionChart.drawRect(482.5,K_PROJECT_HEIGHT,147.5,a),angryLabelText.visible=!0,sadLabelText.visible=!0,surprisedLabelText.visible=!0,happyLabelText.visible=!0,angryLabelText.position.x=K_PROJECT_WIDTH/4+83.75,angryLabelText.position.y=K_PROJECT_HEIGHT+e+30,sadLabelText.position.x=K_PROJECT_WIDTH/4+241.25,sadLabelText.position.y=K_PROJECT_HEIGHT+t+30,surprisedLabelText.position.x=K_PROJECT_WIDTH/4+398.75,surprisedLabelText.position.y=K_PROJECT_HEIGHT+i+30,happyLabelText.position.x=K_PROJECT_WIDTH/4+556.25,happyLabelText.position.y=K_PROJECT_HEIGHT+a+30}}function cleanup(){filmGroup.removeAll(),userVideoGroup.removeAll(),tophatGroup.removeAll(),recordedFeatureGroup.removeAll(),altUserVideoGroup.removeAll(),landmarkGroup.removeAll(),gradientBackgroundGroup.removeAll(),pixelValuesGroup.removeAll(),midgroundGroup.removeAll(),overlayGroup.removeAll(),mapGroup.removeAll(),textGroup.removeAll(),finalOverlayGroup.removeAll(),behindTextBoxesGroup.removeAll(),allTextBoxesGroup.removeAll(),inFrontOfTextBoxGroup.removeAll(),K_INSTALLATION_MODE&&game.input.keyboard.removeKey(Phaser.Keyboard.SPACEBAR)}const playState={create:function(){if(viewerFaceData=[],getLandmarks=!0,getEmotions=!1,activated=!1,frame=0,gameframe=0,lastFrame=0,startTime=0,landmarks=void 0,emotions=void 0,K_MUTE&&(game.sound.mute=!0),K_MULTITHREADING&&(cvWorker.onmessage=function(e){1===e.data.opcode&&handlePlayDetections(e.data.dets,e.data.frame)}),K_INSTALLATION_MODE){let e=0,t=0;const i=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);i.callbackContext=this,i.onDown.add(()=>{e=game.time.now}),i.onUp.add(()=>{(t=game.time.now)-e>=2e3&&(filmVideo.stop(),filmVideo.video.currentTime=0,filmVideo.complete())})}game.world.setBounds(-1e3,-1e3,K_PROJECT_WIDTH+1e3,K_PROJECT_HEIGHT+1e3),frameCanvas=game.add.bitmapData(2,8),filmGroup=game.add.group(),userVideoGroup=game.add.group(),tophatGroup=game.add.group(),recordedFeatureGroup=game.add.group(),altUserVideoGroup=game.add.group(),landmarkGroup=game.add.group(),gradientBackgroundGroup=game.add.group(),pixelValuesGroup=game.add.group(),midgroundGroup=game.add.group(),overlayGroup=game.add.group(),mapGroup=game.add.group(),textGroup=game.add.group(),finalOverlayGroup=game.add.group(),behindTextBoxesGroup=game.add.group(),allTextBoxesGroup=game.add.group(),inFrontOfTextBoxGroup=game.add.group(),cvSprite=game.add.sprite(0,0,userVideo),cvSprite.visible=!1,userVideoAspect=userVideo.width/userVideo.height,userVideoSprite=game.add.sprite(0,0,userVideo),userVideoAspect<K_PROJECT_ASPECT_RATIO?(userVideoBackplateBMD=game.add.bitmapData(userVideo.height*K_PROJECT_ASPECT_RATIO,userVideo.height),userVideoBackplateBMD.fill(255,51,255,0),userVideoBackplateSprite=game.add.sprite(0,0,userVideoBackplateBMD),userVideoGroup.add(userVideoBackplateSprite)):(userVideoAspect,K_PROJECT_ASPECT_RATIO),userVideoGroup.add(userVideoSprite),clmCanvas=game.add.bitmapData(Math.round(cvSprite.width/K_FACE_CV_DOWNRES_FACTOR),Math.round(cvSprite.height/K_FACE_CV_DOWNRES_FACTOR)),userVideoMaskQuarterRight=game.make.graphics(0,0),userVideoMaskQuarterRight.beginFill(16777215),userVideoMaskQuarterRight.drawRect(0,0,.75*K_PROJECT_WIDTH,K_PROJECT_HEIGHT),userVideoMaskQuarterRight.visible=!1,userVideoSprite.mask=userVideoMaskQuarterRight,userVideoGroup.add(userVideoMaskQuarterRight),boundingBox=game.add.graphics(0,0),boundingBox.lineStyle(5,8453888,1),boundingBox.visible=!1,finalOverlayGroup.add(boundingBox),userVideoBackplateBMD?(userVideoSpriteScale=K_PROJECT_WIDTH/userVideoBackplateBMD.width,userVideoBackplateSprite.scale.setTo(userVideoSpriteScale,userVideoSpriteScale),userVideoBackplateSprite.mask=userVideoMaskQuarterRight,userVideoSprite.scale.setTo(userVideoSpriteScale,userVideoSpriteScale)):(userVideoSpriteScale=K_PROJECT_WIDTH/userVideo.width,userVideoSprite.scale.setTo(userVideoSpriteScale,userVideoSpriteScale)),userVideoSprite.position={x:K_PROJECT_WIDTH/2-userVideoSprite.width/2,y:0},filmVideo=game.add.video("film"),filmVideo.onComplete.addOnce(()=>{cleanup(),filmVideo.video.currentTime=0,K_PETITION?game.state.start("petition"):game.state.start("validate")}),filmSprite=game.add.sprite(0,0,filmVideo),filmSprite.visible=!1,filmGroup.add(filmSprite),userVideoProcessedBMD=game.add.bitmapData(Math.round(userVideoSprite.width/K_VIDEO_PROCESSING_DOWNRES_FACTOR),Math.round(userVideoSprite.height/K_VIDEO_PROCESSING_DOWNRES_FACTOR)),altUserVideoProcessedBMD=game.add.bitmapData(Math.round(userVideoSprite.width/K_VIDEO_PROCESSING_DOWNRES_FACTOR),Math.round(userVideoSprite.height/K_VIDEO_PROCESSING_DOWNRES_FACTOR)),userVideoProcessedSprite=game.add.sprite(0,0,userVideoProcessedBMD),userVideoProcessedSprite.visible=!1,userVideoProcessedSprite.mask=userVideoMaskQuarterRight,userVideoProcessedSprite.scale.setTo(K_VIDEO_PROCESSING_DOWNRES_FACTOR,K_VIDEO_PROCESSING_DOWNRES_FACTOR),userVideoProcessedSprite.position={x:K_PROJECT_WIDTH/2-userVideoSprite.width/2,y:0},userVideoGroup.add(userVideoProcessedSprite),userVideoSprite.visible=!1,dimmerScreen=game.add.graphics(0,0),dimmerScreen.beginFill(5855577,.8),dimmerScreen.drawRect(0,0,.75*K_PROJECT_WIDTH,K_PROJECT_HEIGHT),dimmerScreen.visible=!1,userVideoGroup.add(dimmerScreen),emotionChart=game.add.graphics(K_PROJECT_WIDTH/4,0),emotionChart.visible=!1,userVideoGroup.add(emotionChart),angryLabelText=game.add.text(K_PROJECT_WIDTH/4,0,"angry",{font:"Arimo, sans-serif",fontSize:"24px",fill:"#000000"}),angryLabelText.anchor.setTo(.5,.5),angryLabelText.visible=!1,sadLabelText=game.add.text(K_PROJECT_WIDTH/4,0,"sad",{font:"Arimo, sans-serif",fontSize:"24px",fill:"#000000"}),sadLabelText.anchor.setTo(.5,.5),sadLabelText.visible=!1,surprisedLabelText=game.add.text(K_PROJECT_WIDTH/4,0,"surprised",{font:"Arimo, sans-serif",fontSize:"24px",fill:"#000000"}),surprisedLabelText.anchor.setTo(.5,.5),surprisedLabelText.visible=!1,happyLabelText=game.add.text(K_PROJECT_WIDTH/4,0,"happy",{font:"Arimo, sans-serif",fontSize:"24px",fill:"#000000"}),happyLabelText.anchor.setTo(.5,.5),happyLabelText.visible=!1,userVideoGroup.add(angryLabelText),userVideoGroup.add(sadLabelText),userVideoGroup.add(surprisedLabelText),userVideoGroup.add(happyLabelText),userVideoMaskQuarterRight.beginFill(16777215),userVideoMaskQuarterRight.drawRect(0,0,.75*K_PROJECT_WIDTH,K_PROJECT_HEIGHT),userVideoStatusText=game.add.text(K_PROJECT_WIDTH/4+20,20,"face camera and check lighting ",{font:"Arimo, sans-serif",strokeThickness:5,fontStyle:"italic",fontSize:"30px",fontWeight:"bold",fill:"#ff0066"}),userVideoStatusText.setShadow(2,2,"#000000"),userVideoStatusText.visible=!1,userVideoGroup.add(userVideoStatusText),faceModel=game.add.graphics(K_PROJECT_WIDTH/2-userVideoSprite.width/2,0),faceModel.lineStyle(3,8453888,1),faceModel.visible=!1,userVideoGroup.add(faceModel),userVideoGroup.position.x=-K_PROJECT_WIDTH,userVideoMaskQuarterLeft=game.make.graphics(0,0),userVideoMaskQuarterLeft.beginFill(16777215),userVideoMaskQuarterLeft.drawRect(K_PROJECT_WIDTH/4,0,K_PROJECT_WIDTH,K_PROJECT_HEIGHT),userVideoMaskQuarterLeft.visible=!1,userVideoProcessedSpriteLeftMask=game.add.sprite(0,0,userVideoProcessedBMD),userVideoProcessedSpriteLeftMask.mask=userVideoMaskQuarterLeft,userVideoProcessedSpriteLeftMask.visible=!1,userVideoProcessedSpriteLeftMask.scale.setTo(K_VIDEO_PROCESSING_DOWNRES_FACTOR,K_VIDEO_PROCESSING_DOWNRES_FACTOR),userVideoProcessedSpriteLeftMask.position={x:K_PROJECT_WIDTH/2-userVideoSprite.width/2,y:0},altUserVideoGroup.add(userVideoProcessedSpriteLeftMask),altUserVideoGroup.add(userVideoMaskQuarterLeft);for(let e=0;e<K_NUMBER_OF_LANDMARKS;e+=1)landmarkText[e]=game.add.text(0,0,e,{font:"Arimo, sans-serif",fontSize:"7px",fill:"#80ff00"}),landmarkText[e].visible=!1,landmarkGroup.add(landmarkText[e]);K_USER_MUST_INITIATE_VIDEO&&(playButton=game.add.sprite(0,0,"playButtonImage"),playButton.anchor.setTo(.5,.5),playButton.x=K_PROJECT_WIDTH/2,playButton.y=K_PROJECT_HEIGHT/2,playButton.inputEnabled=!0,playButton.input.useHandCursor=!0,playButton.events.onInputOver.add(()=>{playButton.tint=16776986}),playButton.events.onInputOut.add(()=>{playButton.tint=16777215}),playButton.events.onInputDown.addOnce(()=>{if(playButton.inputEnabled=!1,playButton.visible=!1,filmVideo.currentTime=0,filmSprite.visible=!0,startTime=game.time.now,K_MULTITHREADING)createImageBitmap(userVideo.video).then(e=>{cvWorker.postMessage({fakeWindow:fakeWindow,fakeDocument:fakeDocument,img:e,opcode:1,frame:frame,getEmotions:getEmotions},[e]),filmVideo.play(),activated=!0});else{updateCLM(clmCanvas);const e=new faceapi.TinyFaceDetectorOptions({inputSize:160,scoreThreshold:.5});faceapi.detectSingleFace(clmCanvas.canvas,e).withFaceLandmarks(!0).withFaceExpressions().then(()=>{filmVideo.play(),activated=!0})}})),threeTitle=game.add.text(0,0,"3",{font:"Arimo, sans-serif",fontSize:"675px",fontWeight:"bold",fill:"#ff3399"}),threeTitle.setShadow(20,20,"#000000"),threeTitle.anchor.setTo(.5,.5),threeTitle.x=K_PROJECT_WIDTH/2,threeTitle.y=K_PROJECT_HEIGHT/2,threeTitle.visible=!1,twoTitle=game.add.text(0,0,"2",{font:"Arimo, sans-serif",fontSize:"675px",fontWeight:"bold",fill:"#4dff4d"}),twoTitle.setShadow(20,20,"#000000"),twoTitle.anchor.setTo(.5,.5),twoTitle.x=K_PROJECT_WIDTH/2,twoTitle.y=K_PROJECT_HEIGHT/2,twoTitle.visible=!1,oneTitle=game.add.text(0,0,"1",{font:"Arimo, sans-serif",fontSize:"675px",fontWeight:"bold",fill:"#ffffff"}),oneTitle.setShadow(20,20,"#000000"),oneTitle.anchor.setTo(.5,.5),oneTitle.x=K_PROJECT_WIDTH/2,oneTitle.y=K_PROJECT_HEIGHT/2,oneTitle.visible=!1,techQuizTitle=game.add.text(0,0,"TECH\nQUIZ",{font:"Arimo, sans-serif",fontSize:"340px",fontWeight:"bold",fill:"#ffff1a"}),techQuizTitle.setShadow(20,20,"#000000"),techQuizTitle.anchor.setTo(.5,.5),techQuizTitle.x=K_PROJECT_WIDTH/2,techQuizTitle.y=K_PROJECT_HEIGHT/2,techQuizTitle.visible=!1,dogNose=game.add.sprite(0,0,"dogNose"),dogNose.anchor.setTo(.5,.5),behindTextBoxesGroup.add(dogNose),dogNose.visible=!1,dogEars=game.add.sprite(0,0,"dogEars"),dogEars.anchor.setTo(.5,1),behindTextBoxesGroup.add(dogEars),dogEars.visible=!1,tophat=game.add.sprite(0,0,"tophat"),tophat.anchor.setTo(.5,1),tophat.visible=!1,tophatGroup.add(tophat),mustache=game.add.sprite(0,0,"mustache"),mustache.anchor.setTo(.5,.2),mustache.visible=!1,tophatGroup.add(mustache),monocle=game.add.sprite(0,0,"monocle"),monocle.anchor.setTo(.38,.2),monocle.visible=!1,tophatGroup.add(monocle),headPhysicsSprite=game.add.sprite(500,400,"headPhysicsSprite"),headPhysicsSprite.anchor.setTo(.5,.5),headPhysicsSprite.alpha=0,game.physics.enable(headPhysicsSprite,Phaser.Physics.ARCADE),headPhysicsSprite.body.immovable=!0,headPhysicsSprite.visible=!1,dogStats=game.add.text(0,0,"1.000 \n positive ",{font:"Arimo, sans-serif",fontSize:"60px",fontWeight:"bold",strokeThickness:5,fontStyle:"italic",fill:"#33cc33"}),dogStats.setShadow(3,3,"#000000"),dogStats.anchor.setTo(.5,.5),dogStats.x=K_PROJECT_WIDTH/2,dogStats.y=K_PROJECT_HEIGHT/2+40,inFrontOfTextBoxGroup.add(dogStats),dogStats.visible=!1,genderStatsBias=game.add.text(0,0,"+1.000 \n female bias ",{font:"Arimo, sans-serif",fontSize:"60px",fontWeight:"bold",strokeThickness:5,fontStyle:"italic",fill:"#33cc33"}),genderStatsBias.setShadow(3,3,"#000000"),genderStatsBias.anchor.setTo(.5,.5),genderStatsBias.x=37+K_TEXT_BOX_SIZE/2,genderStatsBias.y=37+K_TEXT_BOX_SIZE/2+40,genderStatsBias.visible=!1,kanyeTitle=game.add.text(0,0,"Your reaction to Kanye",{font:"Arimo, sans-serif",fontSize:"82px",fontWeight:"bold",fill:"#000000",backgroundColor:"#ffff1a"}),kanyeTitle.anchor.setTo(.5,.5),kanyeTitle.x=K_PROJECT_WIDTH+kanyeTitle.width/2,kanyeTitle.y=142,kanyeTitle.visible=!0,kanyeBias=game.add.text(0,0,"+1.000 positive",{font:"Arimo, sans-serif",fontSize:"112px",fontWeight:"bold",fill:"#33cc33",backgroundColor:"#000000"}),kanyeBias.anchor.setTo(.5,.5),kanyeBias.x=-kanyeBias.width/2,kanyeBias.y=K_PROJECT_HEIGHT-kanyeBias.height,kanyeBias.visible=!0,pizzaTitle=game.add.text(0,0,"Your reaction to pizza",{font:"Arimo, sans-serif",fontSize:"82px",fontWeight:"bold",fill:"#000000",backgroundColor:"#ffff1a"}),pizzaTitle.anchor.setTo(.5,.5),pizzaTitle.x=K_PROJECT_WIDTH+pizzaTitle.width/2,pizzaTitle.y=142,pizzaTitle.visible=!0,pizzaBias=game.add.text(0,0,"1.000 positive",{font:"Arimo, sans-serif",fontSize:"112px",fontWeight:"bold",fill:"#33cc33",backgroundColor:"#000000"}),pizzaBias.anchor.setTo(.5,.5),pizzaBias.x=-pizzaBias.width/2,pizzaBias.y=K_PROJECT_HEIGHT-pizzaBias.height,pizzaBias.visible=!0,standbyForAIVisionTitle=game.add.text(0,0,"stand by for \nA.I. vision ",{font:"Arimo, sans-serif",fontSize:"150px",fontWeight:"bold",strokeThickness:5,fontStyle:"italic",fill:"#ffffff"}),standbyForAIVisionTitle.setShadow(8,8,"#000000"),standbyForAIVisionTitle.anchor.setTo(.5,.5),standbyForAIVisionTitle.x=K_PROJECT_WIDTH/2,standbyForAIVisionTitle.y=K_PROJECT_HEIGHT/2,standbyForAIVisionTitle.visible=!1,actualImagesUsedToTrainTitle=game.add.text(0,0,"*actual images \nthat trained \nour A.I. ",{font:"Arimo, sans-serif",strokeThickness:5,fontStyle:"italic",fontSize:"70px",fontWeight:"bold",fill:"#ffffff"}),actualImagesUsedToTrainTitle.setShadow(3,3,"#000000"),actualImagesUsedToTrainTitle.anchor.setTo(0,0),actualImagesUsedToTrainTitle.x=20,actualImagesUsedToTrainTitle.y=20,actualImagesUsedToTrainTitle.visible=!1,trainingImageCelebrityTitle=game.add.text(0,0,"(adam sandler) \n",{font:"Arimo, sans-serif",strokeThickness:5,fontSize:"97px",fontStyle:"italic",fontWeight:"bold",fill:"#cccc00"}),trainingImageCelebrityTitle.setShadow(5,5,"#000000"),trainingImageCelebrityTitle.anchor.setTo(.5,0),trainingImageCelebrityTitle.x=K_PROJECT_WIDTH/2,trainingImageCelebrityTitle.y=K_PROJECT_HEIGHT/2,trainingImageCelebrityTitle.visible=!1,instructionsTitle=game.add.text(0,0,"smile!!!",{font:"Arimo, sans-serif",fontSize:"150px",fontWeight:"bold",fill:"#ffff1a",backgroundColor:"#00000"}),instructionsTitle.anchor.setTo(.5,.5),instructionsTitle.x=.75*K_PROJECT_WIDTH,instructionsTitle.y=K_PROJECT_HEIGHT/2,instructionsTitle.visible=!1,midgroundGroup.add(instructionsTitle),raceStatsBias=game.add.text(0,0,"+1.000 \nBlack bias ",{font:"Arimo, sans-serif",fontSize:"60px",fontWeight:"bold",strokeThickness:5,fontStyle:"italic",fill:"#33cc33"}),raceStatsBias.setShadow(3,3,"#000000"),raceStatsBias.anchor.setTo(.5,.5),raceStatsBias.x=37+K_TEXT_BOX_SIZE/2,raceStatsBias.y=37+K_TEXT_BOX_SIZE/2+80,raceStatsBias.visible=!1,gradient2Sprite=game.add.sprite(0,0,"gradient2"),gradient2Sprite.visible=!1,recordedFeatureGroup.add(gradient2Sprite);for(let e=0;e<K_NUMBER_OF_LANDMARKS;e+=1)recordedLandmarkText[e]=game.add.text(0,0,e,{font:"Arimo, sans-serif",fontSize:"8px",fontWeight:"bold",strokeThickness:5,fill:"#ff99ff"}),recordedLandmarkText[e].setShadow(2,2,"#ff0000"),recordedLandmarkText[e].visible=!1,recordedFeatureGroup.add(recordedLandmarkText[e]);recordingOfYourFaceTitle=game.add.text(0,0,"your face vectors \nrecorded 0 seconds ago ",{font:"Arimo, sans-serif",fontSize:"30px",strokeThickness:5,fontStyle:"italic",fontWeight:"bold",fill:"#00ffff",backgroundColor:"#ffff1a"}),recordingOfYourFaceTitle.setShadow(2,2,"#000000"),recordingOfYourFaceTitle.anchor.setTo(.5,.5),recordingOfYourFaceTitle.x=K_PROJECT_WIDTH/4,recordingOfYourFaceTitle.y=100,recordingOfYourFaceTitle.visible=!1,recordedFeatureGroup.add(recordingOfYourFaceTitle),gradient1Sprite=game.add.sprite(0,0,"gradient1"),gradient1Sprite.visible=!1,gradientBackgroundGroup.add(gradient1Sprite),pictureFrameSprite=game.add.sprite(0,0,"pictureFrame"),pictureFrameSprite.anchor.setTo(.5,.5);const e=(K_PROJECT_HEIGHT-100)/pictureFrameSprite.height;if(pictureFrameSprite.scale.setTo(e,e),pictureFrameSprite.x=K_PROJECT_WIDTH/2,pictureFrameSprite.y=K_PROJECT_HEIGHT/2,pictureFrameSprite.visible=!1,overlayGroup.add(pictureFrameSprite),museumCardSprite=game.add.sprite(pictureFrameSprite.x,pictureFrameSprite.y+.2*pictureFrameSprite.height,"museumCard"),museumCardSprite.visible=!1,gradient3Sprite=game.add.sprite(0,0,"gradient3"),gradient3Sprite.visible=!1,overlayGroup.add(gradient3Sprite),yourMouthShapeTitle=game.add.text(0,0,"YOUR MOUTH\nMOMENTS AGO",{font:"Arimo, sans-serif",fontSize:"70px",fontWeight:"bold",fill:"#ffff1a",backgroundColor:"#00000"}),yourMouthShapeTitle.anchor.setTo(.5,.5),yourMouthShapeTitle.x=K_PROJECT_WIDTH/2,yourMouthShapeTitle.y=130,yourMouthShapeTitle.visible=!1,overlayGroup.add(yourMouthShapeTitle),mouthQuantificationTitle=game.add.text(0,0,"0.000000 neutral\n0.000000 happy\n0.000000 sad\n0.000000 angry\n0.000000 fearful\n0.000000 disgusted\n0.000000 surprised",{font:"Arimo, sans-serif",fontSize:"28px",fontWeight:"bold",fill:"#ffffff",backgroundColor:"#00000"}),mouthQuantificationTitle.anchor.setTo(.5,.5),mouthQuantificationTitle.x=K_PROJECT_WIDTH/2+K_PROJECT_WIDTH/4,mouthQuantificationTitle.y=K_PROJECT_HEIGHT/2+20,mouthQuantificationTitle.visible=!1,overlayGroup.add(mouthQuantificationTitle),mouthModel=game.add.graphics(0,0),mouthModel.lineStyle(3,16711680,1),mouthModel.visible=!1,overlayGroup.add(mouthModel),noTitle=game.add.text(0,0,"NO!!!",{font:"Arimo, sans-serif",fontSize:"420px",fontWeight:"bold",fill:"#ff0000"}),noTitle.setShadow(20,20,"#000000"),noTitle.anchor.setTo(.5,.5),noTitle.x=K_PROJECT_WIDTH/2,noTitle.y=K_PROJECT_HEIGHT/2,noTitle.visible=!1,higherOrderQuantificationTitle=game.add.text(0,0,"you \nwill \nsee ",{font:"Arimo, sans-serif",fontSize:"66px",fontWeight:"bold",strokeThickness:5,fontStyle:"italic",fill:"#00ffff",backgroundColor:"#ff33ff"}),higherOrderQuantificationTitle.setShadow(4,4,"#000000"),higherOrderQuantificationTitle.anchor.setTo(.5,.5),higherOrderQuantificationTitle.visible=!1,higherOrderQuantificationLeftPercent=game.add.text(0,0,"50% ",{font:"Arimo, sans-serif",fontSize:"96px",fontWeight:"bold",strokeThickness:5,fontStyle:"italic",fill:"#33cc33"}),higherOrderQuantificationLeftPercent.setShadow(5,5,"#000000"),higherOrderQuantificationLeftPercent.anchor.setTo(.5,.4),higherOrderQuantificationLeftPercent.x=K_PROJECT_WIDTH/4,higherOrderQuantificationLeftPercent.y=K_PROJECT_HEIGHT/2,higherOrderQuantificationLeftPercent.visible=!1,higherOrderQuantificationRightPercent=game.add.text(0,0,"50% ",{font:"Arimo, sans-serif",fontSize:"96px",fontWeight:"bold",strokeThickness:5,fontStyle:"italic",fill:"#ff0000"}),higherOrderQuantificationRightPercent.setShadow(5,5,"#000000"),higherOrderQuantificationRightPercent.anchor.setTo(.5,.4),higherOrderQuantificationRightPercent.x=.75*K_PROJECT_WIDTH,higherOrderQuantificationRightPercent.y=K_PROJECT_HEIGHT/2,higherOrderQuantificationRightPercent.visible=!1,springStudiosMap=game.add.sprite(0,0,"springStudiosMap"),springStudiosMap.visible=!1,mapGroup.add(springStudiosMap),mapGfx=game.add.graphics(-K_PROJECT_WIDTH/2,0),mapGfx.visible=!1,mapGroup.add(mapGfx),mapEmotionLabel=game.add.text(0,0,"feels happy ",{font:"Arimo, sans-serif",fontSize:"72px",fontWeight:"bold",fill:"#0099ff",strokeThickness:5,fontStyle:"italic"}),mapEmotionLabel.setShadow(4,4,"#000000"),mapEmotionLabel.anchor.setTo(.5,.5),mapEmotionLabel.visible=!1,mapGroup.add(mapEmotionLabel),dollarEmitter=game.add.emitter(0,0,K_EMOJI_EXPLOSION_PARTICLES),dollarEmitter.makeParticles("moneyBagEmoji"),dollarEmitter.minParticleSpeed.set(0,300),dollarEmitter.maxParticleSpeed.set(0,400),mapGroup.add(dollarEmitter),pixelatedUserFaceBMD=game.add.bitmapData(40,40),pixelatedUserFaceSprite=game.add.sprite(0,0,pixelatedUserFaceBMD),pixelatedUserFaceSprite.visible=!1,userFaceRawEmotionsText=game.add.text(0,0,"[.000000 .000000 .000000 .000000\n.000000 .000000 .000000]",{font:"Arimo, sans-serif",fontSize:"18px",fontWeight:"bold",fill:"#000000"}),userFaceRawEmotionsText.visible=!1,estimatedIQTitle=game.add.text(0,0,"Your estimated IQ ",{font:"Arimo, sans-serif",fontSize:"72px",fontWeight:"bold",strokeThickness:5,fontStyle:"italic",fill:"#00ffff",backgroundColor:"#ffff1a"}),estimatedIQTitle.setShadow(4,4,"#000000"),estimatedIQTitle.anchor.setTo(.5,.5),estimatedIQTitle.x=K_PROJECT_WIDTH/2,estimatedIQTitle.y=72,estimatedIQTitle.visible=!1,iqStatTitle=game.add.text(0,0,"100 ",{font:"Arimo, sans-serif",fontSize:"440px",fontWeight:"bold",fill:"#33cc33",strokeThickness:5,fontStyle:"italic"}),iqStatTitle.setShadow(20,20,"#000000"),iqStatTitle.anchor.setTo(.5,.5),iqStatTitle.x=K_PROJECT_WIDTH/2,iqStatTitle.y=K_PROJECT_HEIGHT/2,iqStatTitle.visible=!1,computerDesktop=game.add.sprite(0,0,"computerDesktop"),computerDesktop.visible=!1,zuckScreenSpaceBMD=game.add.bitmapData(1920,1080),zuckScreenSpaceSprite=game.add.sprite(0,0,zuckScreenSpaceBMD),mouseCursor=game.add.sprite(-50,K_PROJECT_HEIGHT,"mouseCursor"),mouseCursor.visible=!1,disney=game.add.sprite(0,0,"disney"),disney.anchor.setTo(.5,.5),disney.visible=!1,twentiethCenturyFox=game.add.sprite(0,0,"20thCenturyFox"),twentiethCenturyFox.anchor.setTo(.5,.5),twentiethCenturyFox.visible=!1,kelloggsCornFlakes=game.add.sprite(0,0,"kelloggsCornFlakes"),kelloggsCornFlakes.anchor.setTo(.5,.5),kelloggsCornFlakes.visible=!1,yourLocalPizzeria=game.add.sprite(0,0,"yourLocalPizzeria"),yourLocalPizzeria.anchor.setTo(.5,.5),yourLocalPizzeria.visible=!1,forYourNextJob=game.add.sprite(0,0,"forYourNextJob"),forYourNextJob.anchor.setTo(.5,.5),forYourNextJob.visible=!1,poorHat=game.add.sprite(0,0,"poorHat"),poorHat.anchor.setTo(.5,1),poorHat.visible=!1,crown=game.add.sprite(0,0,"crown"),crown.anchor.setTo(.5,1),crown.visible=!1,leftHeart=game.add.sprite(0,0,"heart"),leftHeart.anchor.setTo(.5,.5),leftHeart.visible=!1,rightHeart=game.add.sprite(0,0,"heart"),rightHeart.anchor.setTo(.5,.5),rightHeart.visible=!1,leftProhibited=game.add.sprite(0,0,"prohibited"),leftProhibited.anchor.setTo(.5,.5),leftProhibited.visible=!1,rightProhibited=game.add.sprite(0,0,"prohibited"),rightProhibited.anchor.setTo(.5,.5),rightProhibited.visible=!1,thoughtBubbleHappy=game.add.sprite(0,0,"thoughtBubbleHappy"),thoughtBubbleHappy.anchor.setTo(1,1),thoughtBubbleHappy.visible=!1,thoughtBubbleSad=game.add.sprite(0,0,"thoughtBubbleSad"),thoughtBubbleSad.anchor.setTo(1,1),thoughtBubbleSad.visible=!1,estimatedIncomeLabel=game.add.text(0,0,"estimated income: $"+estimatedIncome,{font:"Arimo, sans-serif",fontSize:"36px",fontWeight:"bold",fill:"#000000",backgroundColor:"#ffff1a"}),estimatedIncomeLabel.anchor.setTo(1,1),estimatedIncomeLabel.visible=!1,facialAffectLabel=game.add.text(1e3,1e3,"avg facial affect: "+(isMentallyIll?"low":"high"),{font:"Arimo, sans-serif",fontSize:"36px",fontWeight:"bold",fill:"#000000",backgroundColor:"#ffff1a"}),facialAffectLabel.anchor.setTo(1,1),facialAffectLabel.visible=!1,reactionToYourselfLabel=game.add.text(1e3,1e3,"reaction to yourself: "+(isSelfLoathing?"bad":"good"),{font:"Arimo, sans-serif",fontSize:"36px",fontWeight:"bold",fill:"#000000",backgroundColor:"#ffff1a"}),reactionToYourselfLabel.anchor.setTo(1,1),reactionToYourselfLabel.visible=!1,creditTitle=game.add.text(0,0,"written, directed and programmed by\nNOAH LEVENSON",{font:"Arimo, sans-serif",fontSize:"42px",fontWeight:"bold",fill:"#FFFFFF"}),creditTitle.anchor.setTo(.5,.5),creditTitle.visible=!1,mozillaLogoWhite=game.add.sprite(0,0,"mozillaLogoWhite"),mozillaLogoWhite.anchor.setTo(.5,.5),mozillaLogoWhite.visible=!1,K_SHOW_BASEBALL_CARD){const e=K_PROJECT_HEIGHT/userVideo.height;baseballCard=game.add.bitmapData(Math.round(userVideo.width*e),Math.round(userVideo.height*e)+K_BASEBALL_CARD_TEXT_FIELD_HEIGHT)}if(youLikeDogsSFX=game.add.audio("youLikeDogs"),youLikeDogsSFX.volume=.7,youDontLikeDogsSFX=game.add.audio("youDontLikeDogs"),youDontLikeDogsSFX.volume=.7,youPreferMenSFX=game.add.audio("youPreferMen"),youPreferMenSFX.volume=.7,youPreferWomenSFX=game.add.audio("youPreferWomen"),youPreferWomenSFX.volume=.7,youPreferWhitePeopleSFX=game.add.audio("youPreferWhitePeople"),youPreferWhitePeopleSFX.volume=.7,youPreferBlackPeopleSFX=game.add.audio("youPreferBlackPeople"),youPreferBlackPeopleSFX.volume=.7,thatPartBitSFX=game.add.audio("thatPartBit"),thatPartBitSFX.volume=.8,thatPartWaySFX=game.add.audio("thatPartWay"),thatPartWaySFX.volume=.8,isPoorSFX=game.add.audio("isPoor"),isPoorSFX.volume=.7,isNotPoorSFX=game.add.audio("isNotPoor"),isNotPoorSFX.volume=.7,isMentallyIllSFX=game.add.audio("isMentallyIll"),isMentallyIllSFX.volume=.7,isNotMentallyIllSFX=game.add.audio("isNotMentallyIll"),isNotMentallyIllSFX.volume=.7,isSelfLoathingSFX=game.add.audio("isSelfLoathing"),isSelfLoathingSFX.volume=.7,isNotSelfLoathingSFX=game.add.audio("isNotSelfLoathing"),isNotSelfLoathingSFX.volume=.7,kachingSFX=game.add.audio("kaching"),kachingSFX.volume=.3,doubleClickSFX=game.add.audio("doubleclick"),doubleClickSFX.volume=.6,finalPopSFX=game.add.audio("finalPop"),finalPopSFX.volume=.8,dogEmojiEmitter=game.add.emitter(game,0,0,K_EMOJI_EXPLOSION_PARTICLES),dogEmojiEmitter.x=0,dogEmojiEmitter.y=-200,dogEmojiEmitter.bounce.setTo(.5,.5),snapchatEmojiEmitter=game.add.emitter(game,0,0,K_EMOJI_EXPLOSION_PARTICLES),snapchatEmojiEmitter.x=0,snapchatEmojiEmitter.y=-200,snapchatEmojiEmitter.bounce.setTo(.5,.5),snapchatEmojiEmitter.makeParticles("secretEmoji",0,K_EMOJI_EXPLOSION_PARTICLES,!0,!0),applauseEmojiEmitter=game.add.emitter(game,0,0,K_EMOJI_EXPLOSION_PARTICLES),applauseEmojiEmitter.x=0,applauseEmojiEmitter.y=-200,applauseEmojiEmitter.bounce.setTo(.5,.5),applauseEmojiEmitter.makeParticles("moneyFaceEmoji",0,K_EMOJI_EXPLOSION_PARTICLES,!0,!0),K_MOBILE||(fullScreenButton=game.add.sprite(1205,645,"fullscreenButton"),fullScreenButton.scale.setTo(.75,.75),fullScreenButton.tint=9211020,fullScreenButton.events.onInputOver.add(function(){fullScreenButton.tint=16777215}),fullScreenButton.events.onInputOut.add(function(){fullScreenButton.tint=9211020}),fullScreenButton.events.onInputDown.add(function(){game.scale.startFullScreen(),fullScreenButton.tint=9211020,K_INSTALLATION_MODE&&(game.canvas.style.cursor="none")}),fullScreenButton.visible=!1,fullScreenButton.inputEnabled=!0,fullScreenButton.input.useHandCursor=!0),K_DEBUG&&(K_DEBUG_SHOW_FRAMECODE&&(framecodeSprite=game.add.sprite(0,0,frameCanvas),framecodeSprite.scale.setTo(K_DEBUG_FRAMECODE_SCALE,K_DEBUG_FRAMECODE_SCALE)),pauseKey=game.input.keyboard.addKey(Phaser.Keyboard.P),pauseKey.onDown.add(()=>{filmVideo.paused?filmVideo.paused=!1:filmVideo.paused=!0}),frameQueryKey=game.input.keyboard.addKey(Phaser.Keyboard.F),frameQueryKey.onDown.add(()=>{console.log(getFrame(filmSprite,frameCanvas))}),seekKey=game.input.keyboard.addKey(Phaser.Keyboard.S),seekKey.onDown.add(()=>{filmVideo.video.currentTime=K_DEBUG_SEEK_TIME;for(let e=0;e<filmEventList.length;e+=1)filmEventList[e]&&(filmEventList[e].activated=!1)})),!K_USER_MUST_INITIATE_VIDEO)if(filmVideo.currentTime=0,filmSprite.visible=!0,startTime=game.time.now,K_MULTITHREADING)createImageBitmap(userVideo.video).then(e=>{cvWorker.postMessage({fakeWindow:fakeWindow,fakeDocument:fakeDocument,img:e,opcode:1,frame:frame,getEmotions:getEmotions},[e]),filmVideo.play(),activated=!0});else{updateCLM(clmCanvas);const e=new faceapi.TinyFaceDetectorOptions({inputSize:160,scoreThreshold:.5});faceapi.detectSingleFace(clmCanvas.canvas,e).withFaceLandmarks(!0).withFaceExpressions().then(()=>{filmVideo.play(),activated=!0})}},update:async function(){if(activated){gameframe%K_GET_OPTICAL_SYNC_INTERVAL==0?frame=getFrame(filmSprite,frameCanvas):frame=lastFrame;const e=frame-lastFrame;if(e>1)for(let t=0;t<e;t+=1)doEvent(filmEventList,lastFrame+t);if(frame%K_CV_REFRESH_INTERVAL==0)if(K_MULTITHREADING)createImageBitmap(userVideo.video).then(e=>{cvWorker.postMessage({fakeWindow:fakeWindow,fakeDocument:fakeDocument,img:e,opcode:1,frame:frame,getEmotions:getEmotions},[e])});else{updateCLM(clmCanvas);const e=frame,t=new faceapi.TinyFaceDetectorOptions({inputSize:160,scoreThreshold:.5});let i;getEmotions?i=K_RUN_CV_ASYNC?faceapi.detectSingleFace(clmCanvas.canvas,t).withFaceLandmarks(!0).withFaceExpressions():await faceapi.detectSingleFace(clmCanvas.canvas,t).withFaceLandmarks(!0).withFaceExpressions():(i=K_RUN_CV_ASYNC?faceapi.detectSingleFace(clmCanvas.canvas,t).withFaceLandmarks(!0):await faceapi.detectSingleFace(clmCanvas.canvas,t).withFaceLandmarks(!0),emotions=!1),K_RUN_CV_ASYNC?i.then(t=>{handlePlayDetections(t,e)}):handlePlayDetections(i,e)}doEvent(filmEventList,frame),lastFrame=frame,gameframe+=1,K_MOBILE||(game.scale.isFullScreen?fullScreenButton.visible=!1:fullScreenButton.visible=!0),K_DEBUG&&K_DEBUG_LOG_ALL_FRAMES&&console.log(frame),K_BETA&&fpsSamples.push(game.time.fps)}}};